name: Deploy from Zip File

on:
  push:
    paths:
      - '**.zip'
  workflow_dispatch:

jobs:
  deploy:
    runs-on: ubuntu-latest
    permissions:
      contents: write
    
    steps:
      - name: Checkout repository
        uses: actions/checkout@v4
      
      - name: Deploy from zip
        run: |
          echo "ğŸš€ Starting deployment from zip file..."
          
          # Find the zip file
          ZIP_FILE=$(find . -maxdepth 1 -name "*.zip" -type f | head -n 1)
          
          if [ -z "$ZIP_FILE" ]; then
            echo "âŒ No zip file found in root directory"
            exit 1
          fi
          
          echo "ğŸ“¦ Found zip file: $ZIP_FILE"
          ZIP_FILENAME=$(basename "$ZIP_FILE")
          
          # Create temp directory for extraction
          TEMP_DIR="temp_extract"
          mkdir -p "$TEMP_DIR"
          
          # Extract zip to temp directory
          echo "ğŸ“‚ Extracting zip file..."
          unzip -qq "$ZIP_FILE" -d "$TEMP_DIR"
          
          # Delete all files except the zip and .git directory
          echo "ğŸ§¹ Removing old files (keeping .git and zip)..."
          find . -mindepth 1 -maxdepth 1 ! -name '.git' ! -name "$ZIP_FILENAME" ! -name "$TEMP_DIR" -exec rm -rf {} +
          
          # Move extracted contents to root
          echo "ğŸ“ Moving extracted files to root..."
          mv "$TEMP_DIR"/* . 2>/dev/null || mv "$TEMP_DIR"/.* . 2>/dev/null || true
          
          # Clean up temp directory and zip file
          echo "ğŸ§  Cleaning up..."
          rm -rf "$TEMP_DIR"
          rm -f "$ZIP_FILE"
          
          echo "âœ… Deployment preparation complete!"
      
      - name: Commit and push changes
        run: |
          git config --local user.email "github-actions[bot]@users.noreply.github.com"
          git config --local user.name "github-actions[bot]"
          
          git add -A
          
          if git diff --staged --quiet; then
            echo "â„¹ï¸ No changes to commit"
          else
            git commit -m "ğŸš€ Auto-deploy: Extracted and deployed from zip file"
            git push
            echo "âœ… Changes committed and pushed successfully!"
          fi
